@startuml C4_Containers
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title Container diagram for Keep AIOps Platform

Person(user, "Platform User", "Operations engineer or developer who manages alerts and incidents")
Person(admin, "Platform Admin", "Administrator who configures and maintains the system")

System_Boundary(keep, "Keep AIOps Platform") {
    Container(webApp, "Keep UI", "TypeScript, Next.js, React, Tailwind CSS", "Provides the web interface for users to manage alerts, incidents, and workflows")
    
    Container(api, "Keep API", "Python, FastAPI", "Core backend that handles business logic, API endpoints, and orchestrates platform functionality")
    
    Container(wsServer, "WebSocket Server", "Soketi", "Provides real-time updates and notifications to connected clients")
    
    Container(database, "Database", "PostgreSQL/MySQL/SQLite/SQL Server", "Stores alerts, incidents, workflows, and configuration")
    
    Container(backgroundTasks, "Background Task Processor", "ARQ", "Handles asynchronous processing for alerts, incidents, and workflow execution")
    
    Container(secretsManager, "Secrets Manager", "File/GCP/K8S/Vault", "Securely stores and manages provider credentials and secrets")
    
    Container(auth, "Authentication", "OAuth2/Keycloak/Auth0", "Handles user authentication and authorization")
}

System_Ext(observability, "Observability Tools", "Generate alerts (Prometheus, Datadog, etc.)")
System_Ext(ticketing, "Ticketing Systems", "Track incidents (Jira, ServiceNow, etc.)")
System_Ext(communication, "Communication Channels", "Send notifications (Slack, etc.)")
System_Ext(aiProviders, "AI Services", "LLM providers (OpenAI, Anthropic, etc.)")
System_Ext(documentation, "Documentation Systems", "Knowledge bases (Notion, etc.)")
System_Ext(cmdb, "CMDB Systems", "Asset tracking (ServiceNow CMDB, etc.)")

Rel(user, webApp, "Uses", "HTTPS")
Rel(admin, webApp, "Configures", "HTTPS")

Rel(webApp, api, "Makes API calls to", "HTTPS/JSON")
Rel(webApp, wsServer, "Subscribes to updates", "WebSocket")

Rel(api, wsServer, "Publishes events to", "Internal")
Rel(api, database, "Reads from and writes to", "SQL/ORM")
Rel(api, backgroundTasks, "Schedules jobs", "Redis")
Rel(api, secretsManager, "Retrieves secrets from", "Internal API")
Rel(api, auth, "Authenticates users via", "OAuth/OIDC")

Rel(backgroundTasks, database, "Reads from and writes to", "SQL/ORM")
Rel(backgroundTasks, secretsManager, "Retrieves secrets from", "Internal API")

Rel_L(observability, api, "Sends alerts to", "Webhooks/API")
Rel_R(api, observability, "Queries and controls", "API")

Rel_U(api, ticketing, "Creates and updates tickets in", "API")
Rel_D(ticketing, api, "Webhook callbacks from", "API")

Rel_U(api, communication, "Sends notifications via", "API")
Rel_D(communication, api, "Webhook callbacks from", "API")

Rel_D(api, aiProviders, "Requests completions and embeddings from", "API")
Rel_D(api, documentation, "Retrieves context from", "API")
Rel_D(api, cmdb, "Queries asset information from", "API")

@enduml 